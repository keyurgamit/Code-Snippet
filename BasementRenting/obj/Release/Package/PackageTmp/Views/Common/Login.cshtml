@model List<EntityModel.DomainModel.UserRole>
@{
    ViewBag.Title = "Login";
}

<div class="login-page">
    <div class="breadcrumb">
        <div class="container">
            <div class="breadcrumb-item active">Login <icon>/</icon> Register </div>
        </div>
    </div>
    <div class="container_prn01">
        <div class="container">
            <!-- Nav tabs -->
            <div class="loginframe">
                @if (ViewBag.LoginStatusMessage != null)
                {
                    <span class="form-error login-error">@ViewBag.LoginStatusMessage</span>
                    @*<script>$(".form-error-ajax").hide();</script>*@
                }
                @*@if (ViewBag.RegisterStatusMessage != null)
                {
                    <span class="form-error">@ViewBag.RegisterStatusMessage</span>
                }*@

                <span class="form-error form-error-ajax" style="display:none;"></span>

                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="nav-item active">
                        <a class="nav-link nav-login-link" href="#login" aria-controls="login" role="tab" data-toggle="tab">Login</a>
                    </li>
                    <li role="presentation" class="nav-item">
                        <a class="nav-link nav-register-link" href="#register" aria-controls="register" role="tab" data-toggle="tab">Register</a>
                    </li>
                </ul>
                <div class="clearfix"></div>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-login tab-pane active" id="login">
                        @using (Html.BeginForm("Login", "Customer", FormMethod.Post, new { id = "loginForm" }))
                        {
                            <div class="formdiv">
                                <div class="form-group">
                                    @Html.Label("Email", new { @class = "frmlbl" })<required>*</required>
                                    <input type="text" id="txtEmail" name="txtEmail" class="form-control" placeholder="Enter Your Email" />
                                    <span class="login-email-error" style="color:red;"></span>
                                </div>
                                <div class="form-group">
                                    @Html.Label("Password", new { @class = "frmlbl" })<required>*</required>
                                    <input type="password" id="txtPassword" name="txtPassword" class="form-control" placeholder="Enter Your Password" />
                                </div>
                                <div class="form-group btnprn">
                                    <button type="button" id="Login" value="Login" class="btn btn-twoblue" onclick="checkValidationForLogin();"> <i class="iicon basement-renting-lock"></i> Login </button>
                                </div>
                                <div class="passlink">
                                    <a class="fplink" href="@Url.Action("PasswordRecovery", "Customer")">Forgot Password?</a>
                                </div>
                            </div>
                        }
                    </div>

                    <div role="tabpanel" class="tab-register tab-pane " id="register">
                        @using (Html.BeginForm("register", "customer", FormMethod.Post, new { id = "registerForm" }))
                        {
                            <div class="formdiv">
                                <div class="form-group custom-radio-group">
                                    <label class="lael01">Register As</label>
                                    @*<label class="customradiop">
                                            <input type="radio" class="radio-inline" name="rdoRegisterAs" value="6579e97bd084" checked="checked" />
                                            <span class="customradio"></span> Customer
                                        </label>
                                        <label class="customradiop">
                                            <input type="radio" class="radio-inline" name="rdoRegisterAs" value="9b97afc93024" />
                                            <span class="customradio"></span> Landlord
                                        </label>*@

                                    @foreach (var item in Model)
                                    {
                                        <label class="customradiop">
                                            <input type="radio" class="radio-inline" name="rdoRegisterAs" value="@item.RoleId" checked="checked" />
                                            <span class="customradio"></span> @item.RoleName
                                        </label>
                                    }
                                </div>
                                <div class="form-group">
                                    <label class="frmlbl">Name</label><required>*</required>
                                    <input type="text" class="form-control" id="txtName" name="txtName" placeholder="Enter Your Name" />
                                </div>

                                <div class="form-group">
                                    <label class="frmlbl">Email</label><required>*</required>
                                    <input type="text" class="form-control" id="txtEmailReg" name="txtEmailReg" placeholder="Enter Your Email" />
                                    <span class="registration-email-error" style="color:red;"></span>
                                </div>

                                <div class="form-group">
                                    <label class="frmlbl">Phone Number</label><required>*</required>
                                    <input type="text" class="form-control" id="txtPhone" maxlength="10" name="txtPhone" placeholder="Enter Your Phone Number (ex. 64xxxxxxxx)" />
                                    <div class="registration-phonenumber-error" style="color:red;"></div>
                                </div>

                                <div class="form-group">
                                    <label class="frmlbl">Password</label><required>*</required>
                                    <input type="password" id="txtPasswordReg" name="txtPasswordReg" class="form-control" placeholder="Enter Your Password" />
                                </div>

                                <div class="form-group">
                                    <label class="frmlbl">Confirm Password</label><required>*</required>
                                    <input type="password" id="txtConfirmPasswordReg" name="txtConfirmPasswordReg" class="form-control" placeholder="Enter Your Confirm Password" />
                                    <span class="registration-password-mismatch-error" style="color:red;"></span>
                                </div>
                                <div class="form-group custom-check-group ">
                                    <label class="customcheckboxp">
                                        <input type="checkbox" id="TermsAndConditions" name="TermsAndConditions" value="TermsAndConditions" />
                                        <span class="customcheckbox"></span>  Agree to <a href="@Url.Action("terms-and-conditions", "home")">Terms and Conditions</a><required>*</required>
                                        <div class="registration-termscondition-error" style="color:red;"></div>
                                    </label>
                                    <label class="customcheckboxp">
                                        <input type="checkbox" id="chkNewsLetter" name="chkNewsLetter" />
                                        <span class="customcheckbox"></span>  Agree to receive email communications<required>*</required>
                                        <div class="registration-newsletter-error" style="color:red;"></div>
                                    </label>
                                </div>
                                <div class="form-group btnprn">
                                    <button type="button" id="Register" class="btn btn-twoblue" onclick="checkValidationForRegister();"><i class="fa fa-edit"></i> Register </button>
                                </div>
                            </div>
                        }
                    </div>

                </div>

            </div>
        </div>

        <div class="waiting-loader-wrraper fill"><img src="~/Content/Images/customloader---white.gif" class="waiting-loader" /></div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('.top-footer').addClass('border');

        $(".nav-link").click(function () {
            if ($(this).hasClass("nav-login-link")) {
                $(".form-error-ajax").hide();
            }
            else {
                $(".login-error").hide();
            }
        });

        $("#txtPhone").keypress(function (e) {
            //if the letter is not digit then display error and don't type anything
            if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57) /*&& String.fromCharCode(e.which) != '-'*/) {
                //display error message
                //$("#errmsg").html("Digits Only").show().fadeOut("slow");
                return false;
            }
        });

        $('#txtPassword').keypress(function (e) {
            if (e.which == 13) {//Enter key pressed
                $("#loginForm").submit();
            }
        });
    }); //end of doc. ready

    function checkValidationForLogin() {
        var IsSubmitForm = false;
        $(".login-email-error").hide();

        if ($("#txtEmail").val() === "") {
            $("#txtEmail").css("border-color", "red");

            IsSubmitForm = false;
        }
        else {
            $("#txtEmail").css("border-color", "");

            if (validateEmailId($("#txtEmail").val()) == true) {
                if ($("#txtPassword").val() == "") {
                    $("#txtPassword").css("border-color", "red");

                    IsSubmitForm = false;
                }
                else {
                    $("#txtPassword").css("border-color", "");

                    IsSubmitForm = true;
                }
            }
            else {
                $("#txtEmail").css("border-color", "red");
                $(".login-email-error").show();
                $(".login-email-error").html("Please enter valid Email.");

                IsSubmitForm = false;
            }
        }

        if (IsSubmitForm == true) {
            $("#loginForm").submit();
        }
    } //end of checkValidationForLogin()

    function checkValidationForRegister() {
        $(".registration-email-error").hide();
        $(".registration-phonenumber-error").hide();
        $(".registration-password-mismatch-error").hide();
        $(".registration-termscondition-error").hide();
        $(".registration-newsletter-error").hide();

        $("#txtName").css("border-color", "");
        $("#txtEmailReg").css("border-color", "");
        $("#txtPhone").css("border-color", "");
        $("#txtPasswordReg").css("border-color", "");
        $("#txtConfirmPasswordReg").css("border-color", "");

        var IsSubmitForm = true;

        if ($("#txtName").val() === "") {
            $("#txtName").css("border-color", "red");
            IsSubmitForm = false;
        }

        if ($("#txtEmailReg").val() === "") {
            $("#txtEmailReg").css("border-color", "red");
            IsSubmitForm = false;
        }
        else {
            $("#txtEmailReg").css("border-color", "");
            $("#txtPhone").css("border-color", "");
            $("#txtPasswordReg").css("border-color", "");
            $("#txtConfirmPasswordReg").css("border-color", "");

            if (validateEmailId($("#txtEmailReg").val()) == false) {
                $("#txtEmailReg").css("border-color", "red");

                $(".registration-email-error").show();
                $(".registration-email-error").html("Please enter valid Email.");
                IsSubmitForm = false;
            }
        }

        if ($("#txtPhone").val() === "" || $('#txtPhone').val().length < 10) {
            $("#txtPhone").css("border-color", "red");
            $(".registration-phonenumber-error").html("Enter 10 digit phone number.");
            $(".registration-phonenumber-error").show();
            IsSubmitForm = false;
        }

        if ($("#txtPasswordReg").val() === "") {
            $("#txtPasswordReg").css("border-color", "red");
            IsSubmitForm = false;
        }

            if ($("#txtConfirmPasswordReg").val() === "") {
                $("#txtConfirmPasswordReg").css("border-color", "red");
                IsSubmitForm = false;
            }

        if ($("#txtPasswordReg").val() != "" && $("#txtConfirmPasswordReg").val() != "") {

            if ($("#txtPasswordReg").val() == $("#txtConfirmPasswordReg").val()) {

                if ($("#TermsAndConditions").prop("checked") == false) {
                    $(".registration-termscondition-error").html("Please Accept Terms And Conditions..!");
                    $(".registration-termscondition-error").show();
                    IsSubmitForm = false;
                }

                if ($("#chkNewsLetter").prop("checked") == false) {

                    $(".registration-newsletter-error").html("Please agree to receive email communications..!");
                    $(".registration-newsletter-error").show();
                    IsSubmitForm = false;
                }
            }
            else {
                $(".registration-password-mismatch-error").html("Password does not match..!");
                $(".registration-password-mismatch-error").show();
                IsSubmitForm = false;
            }
        }
        else {
            $(".registration-password-mismatch-error").html("Password does not Empty..!");
            $(".registration-password-mismatch-error").show();
            IsSubmitForm = false;
        }


        if (IsSubmitForm == true) {
            //$("#registerForm").submit();

            $(".waiting-loader-wrraper, .waiting-loader").show();

            $.ajax({
		        url: "@Url.Action("register", "customer")",
		        type: "POST",
                data: $("#registerForm").serialize(),
		        async: false,
                success: function (data) {
                    //console.log("Status: " + data.RegisterStatus, ", Message: " + data.RegisterStatusMessage);
                    if (data.RegisterStatus == true) {
                        @*window.location.href = "@Url.Action("index", "home")";*@
                        @*console.log("MailId: " + data.MailId,", Mail Status: " + data.MailStatus);*@

                        $(".waiting-loader-wrraper, .waiting-loader").hide();

                        $.confirm({
                            title: 'Registered!',
                            content: 'Please check your email to activate your account, and then please try to login.',
                            buttons: {
                                somethingElse: {
                                    text: 'Go to Login',
                                    btnClass: 'btn-blue',
                                    keys: ['enter', 'shift'],
                                    action: function(){
                                        window.location.href = "@Url.Action("login", "customer")";
                                    }
                                }
                            }
                        });//end of confirm
                    }
                    else {
                        $(".waiting-loader-wrraper, .waiting-loader").hide();
                        $(".form-error-ajax").html(data.RegisterStatusMessage);
                        $(".form-error-ajax").show();
                        $(".breadcrumb-item.active")[0].scrollIntoView(true);
                        $(".login-error").hide();
                    }
		        },
		        error: function () {
			        console.log("Error Occured!");
		        }
	        });//end - ajax call

            @*$.ajax({
		        url: "@Url.Action("registrationmailtouser", "customer")",
		        type: "GET",
		        async: false,
                success: function (data) {
                    if (data == "True") {
                        console.log("1st mail sent successfully");

                        $.ajax({
		                    url: "@Url.Action("registrationmailtoadmin", "customer")",
		                    type: "GET",
		                    async: false,
                            success: function (data) {
                                if (data == "True") {
                                    console.log("2nd mail sent successfully");
			                    } else {
				                    alert("Error Occurs!");
			                    }
		                    },
		                    error: function () {
			                    console.log("Error Occured!");
		                    }
	                    });//end - ajax call
			        } else {
                        console.log("Error In Function!");
			        }
		        },
		        error: function () {
			        console.log("Error Occured!");
		        }
	        });//end - ajax call*@
        }
    } //end of checkValidationForRegister()

    function validateEmailId(emailId) {
        var x = emailId; //$("#txtEmailReg").val();
        var atpos = x.indexOf("@@");
        var dotpos = x.lastIndexOf(".");
        if (atpos < 1 || dotpos < atpos + 2 || dotpos + 2 >= x.length) {
            //alert("Invalid E-mail address");
            return false;
        }
        else {
            return true;
        }
    }
</script>